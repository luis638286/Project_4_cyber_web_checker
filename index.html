<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Website Security Checker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 0 16px;
    }
    h1 {
      color: #333;
    }
    label, input, button {
      font-size: 16px;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      margin: 8px 0 12px;
      box-sizing: border-box;
    }
    button {
      padding: 8px 16px;
      background: #0078ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:disabled {
      background: #888;
      cursor: default;
    }
    #status {
      margin-top: 16px;
      font-weight: bold;
    }
    pre {
      background: #f5f5f5;
      padding: 12px;
      border-radius: 4px;
      white-space: pre-wrap;
    }
    .ok { color: green; }
    .bad { color: #c00; }
  </style>
</head>
<body>

<h1>Project 4 â€“ Website Security Checker</h1>
<p>
  Enter a website URL and this tool will check some basic security properties
  (HTTPS, redirects, headers, cookies). The actual scanning logic runs in a
  Python backend; this page just calls the API and shows the results.
</p>

<form id="scan-form">
  <label for="url-input">Website URL:</label>
  <input id="url-input" type="text" placeholder="https://example.com" required>
  <button type="submit" id="scan-btn">Scan</button>
</form>

<div id="status"></div>
<div id="results"></div>

<script>
  const BACKEND_URL = "https://project-4-fontys-backend.onrender.com/scan";

  const form = document.getElementById("scan-form");
  const urlInput = document.getElementById("url-input");
  const statusEl = document.getElementById("status");
  const resultsEl = document.getElementById("results");
  const btn = document.getElementById("scan-btn");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const url = urlInput.value.trim();
    if (!url) return;

    statusEl.textContent = "Scanning...";
    statusEl.className = "";
    resultsEl.innerHTML = "";
    btn.disabled = true;

    try {
      const res = await fetch(BACKEND_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
      });

      const text = await res.text();   // get raw text first
      let data;

      try {
        data = JSON.parse(text);       // try parse JSON
      } catch (e) {
        throw new Error("Backend did not return JSON. Raw response: " + text.slice(0, 200));
      }

      if (!res.ok || data.error) {
        statusEl.textContent = "Error: " + (data.error || "Unknown error");
        statusEl.className = "bad";
        btn.disabled = false;
        return;
      }

      let out = "";
      out += "Scanned URL: " + data.url + "\n";
      out += "Status code: " + data.status_code + "\n\n";

      out += "HTTPS enabled: " + (data.https ? "YES" : "NO") + "\n";

      out += "HTTP -> HTTPS redirect: ";
      if (data.redirects_to_https === null) {
        out += "Unknown (could not check)\n";
      } else {
        out += (data.redirects_to_https ? "YES" : "NO") + "\n";
      }

      out += "\nMissing security headers:\n";
      if (data.missing_headers && data.missing_headers.length) {
        data.missing_headers.forEach(h => {
          out += " - " + h + "\n";
        });
      } else {
        out += " - None (all present from our list)\n";
      }

      out += "\nCookie issues:\n";
      if (data.cookie_issues && data.cookie_issues.length) {
        data.cookie_issues.forEach(c => {
          out += " - " + c + "\n";
        });
      } else {
        out += " - None detected\n";
      }

      statusEl.textContent = "Scan completed.";
      statusEl.className = "ok";
      resultsEl.innerHTML = "<pre>" + out + "</pre>";

    } catch (err) {
      statusEl.textContent = "Request failed: " + err.message;
      statusEl.className = "bad";
    } finally {
      btn.disabled = false;
    }
  });
</script>


</body>
</html>
